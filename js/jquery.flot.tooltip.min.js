/*
 * jquery.flot.tooltip
 * 
 * description: easy-to-use tooltips for Flot charts
 * version: 0.6.2
 * author: Krzysztof Urbas @krzysu [myviews.pl]
 * website: https://github.com/krzysu/flot.tooltip
 * 
 * build on 2013-12-20
 * released under MIT License, 2012
*/ 
!function(a){var b={tooltip:!1,tooltipOpts:{content:"%s | X: %x | Y: %y",xDateFormat:null,yDateFormat:null,shifts:{x:10,y:20},defaultTheme:!0,stickyable:!1,stickyClass:"flotTipSticky",onHover:function(){},onClick:function(){}}},c=function(a){this.tipPosition={x:0,y:0},this.init(a)};c.prototype.init=function(b){function c(a){var b={};b.x=a.pageX,b.y=a.pageY,g.updateTooltipPosition(b)}function d(a,b,c){if(!g.stickyItem){var d=g.getDomElement();if(c){var e;e=g.stringFormat(g.tooltipOptions.content,c),d.html(e),g.updateTooltipPosition({x:b.pageX,y:b.pageY}),d.css({left:g.tipPosition.x+g.tooltipOptions.shifts.x,top:g.tipPosition.y+g.tooltipOptions.shifts.y}).show(),"function"==typeof g.tooltipOptions.onHover&&g.tooltipOptions.onHover(c,d)}else f()}}function e(a,b,c){var e=g.getDomElement();g.tooltipOptions.stickyable&&(c&&!g.stickyItem?(g.stickyItem=c,g.plot.highlight(c.seriesIndex,c.dataIndex),e.addClass(g.tooltipOptions.stickyClass),"function"==typeof g.tooltipOptions.onClick&&g.tooltipOptions.onClick.call(g.plot,c,e,!0)):(f(),d(a,b,c),e.removeClass(g.tooltipOptions.stickyClass),"function"==typeof g.tooltipOptions.onClick&&g.tooltipOptions.onClick.call(g.plot,c,e,!1))),g.lastClickTimeStamp=a.timeStamp}function f(){var a=g.getDomElement();a.hide().html(""),g.stickyItem&&(g.plot.unhighlight(g.stickyItem.seriesIndex,g.stickyItem.dataIndex),g.stickyItem=null)}var g=this;g.$placeholder=b.getPlaceholder(),g.plot=b,b.hooks.bindEvents.push(function(b,f){if(g.plotOptions=b.getOptions(),g.plotOptions.tooltip!==!1&&"undefined"!=typeof g.plotOptions.tooltip){g.tooltipOptions=g.plotOptions.tooltipOpts;{g.getDomElement()}a(b.getPlaceholder()).bind("plothover",d),g.tooltipOptions.stickyable&&a(b.getPlaceholder()).bind("plotclick",e),a(f).bind("mousemove",c)}}),b.hooks.shutdown.push(function(b,f){a(b.getPlaceholder()).unbind("plothover",d),a(b.getPlaceholder()).unbind("plotclick",e),g.getDomElement().remove(),a(f).unbind("mousemove",c)})},c.prototype.getDomElement=function(){return this.$flotTip||(this.$flotTip=a("<div />").attr("class","flotTip"),this.$flotTip.appendTo("body").hide().css({position:"absolute"}),this.tooltipOptions.defaultTheme&&this.$flotTip.css({background:"#fff","z-index":"100",padding:"0.4em 0.6em","border-radius":"0.5em","font-size":"0.8em",border:"1px solid #111",display:"none","white-space":"nowrap"})),this.$flotTip},c.prototype.updateTooltipPosition=function(b){var c=this.getDomElement(),d=c.outerWidth()+this.tooltipOptions.shifts.x,e=c.outerHeight()+this.tooltipOptions.shifts.y;b.x-a(window).scrollLeft()>a(window).innerWidth()-d&&(b.x-=d),b.y-a(window).scrollTop()>a(window).innerHeight()-e&&(b.y-=e),this.tipPosition.x=b.x,this.tipPosition.y=b.y},c.prototype.stringFormat=function(a,b){var c=/%p\.{0,1}(\d{0,})/,d=/%s/,e=/%x\.{0,1}(?:\d{0,})/,f=/%y\.{0,1}(?:\d{0,})/,g=b.datapoint[0],h=b.datapoint[1];return"function"==typeof a&&(a=a(b.series.label,g,h,b)),"undefined"!=typeof b.series.percent&&(a=this.adjustValPrecision(c,a,b.series.percent)),"undefined"!=typeof b.series.label&&(a=a.replace(d,b.series.label)),this.isTimeMode("xaxis",b)&&this.isXDateFormat(b)&&(a=a.replace(e,this.timestampToDate(g,this.tooltipOptions.xDateFormat))),this.isTimeMode("yaxis",b)&&this.isYDateFormat(b)&&(a=a.replace(f,this.timestampToDate(h,this.tooltipOptions.yDateFormat))),"number"==typeof g&&(a=this.adjustValPrecision(e,a,g)),"number"==typeof h&&(a=this.adjustValPrecision(f,a,h)),"undefined"!=typeof b.series.xaxis.tickFormatter&&(a=a.replace(e,b.series.xaxis.tickFormatter(g,b.series.xaxis))),"undefined"!=typeof b.series.yaxis.tickFormatter&&(a=a.replace(f,b.series.yaxis.tickFormatter(h,b.series.yaxis))),a},c.prototype.isTimeMode=function(a,b){return"undefined"!=typeof b.series[a].options.mode&&"time"===b.series[a].options.mode},c.prototype.isXDateFormat=function(){return"undefined"!=typeof this.tooltipOptions.xDateFormat&&null!==this.tooltipOptions.xDateFormat},c.prototype.isYDateFormat=function(){return"undefined"!=typeof this.tooltipOptions.yDateFormat&&null!==this.tooltipOptions.yDateFormat},c.prototype.timestampToDate=function(b,c){var d=new Date(b);return a.plot.formatDate(d,c)},c.prototype.adjustValPrecision=function(a,b,c){var d,e=b.match(a);return null!==e&&""!==RegExp.$1&&(d=RegExp.$1,c=c.toFixed(d),b=b.replace(a,c)),b};var d=function(a){new c(a)};a.plot.plugins.push({init:d,options:b,name:"tooltip",version:"0.6.1"})}(jQuery);